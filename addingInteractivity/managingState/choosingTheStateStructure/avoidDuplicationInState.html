<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid duplication in State</title>
    <link rel="stylesheet" href="choosingStateStructure.css">
</head>
<body>
    <!-- Div for rendering -->
    <div id="main"></div>

    <!-- Scripts for React, React DOM & Babel -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- General Script -->
    <script type="text/jsx">            
        const { useState } = React;

        const initialItems = [
            {title: 'pretzels', id: 0},
            {title:'crispy seaweed', id: 1},
            {title: 'granola bar', id: 2}
        ];

        function Intro(){
            return(
                <>
                    <h1>Avoid duplication in state</h1>
                    <p>The following menu list allows you to choose a single travel snack from several:</p>
                    <MenuList/>
                    <p>
                        Currently, it stores the selected item as an object in the state variable
                        <span className="bg-grey">selectedItem</span>. However, this is not right: the content of 
                        <span className="bg-grey">selectedItem</span> is the same object as one of the elements within the list of 
                        <span className="bg-grey">items</span>. This means that the information about the item itself is duplicated in two places.
                    </p>
                    <p>Why is this a problem? Let's make each element editable:</p>
                    <EditableMenuList/>
                </>
            )
        }

        function MenuList(){
            const [items, setItems] = useState(initialItems);
            const [selectedItem, setSelectedItem] = useState(items[0]);

            return(
                <div>
                    <h2>What is your travel snack?</h2>
                    <ul>
                        {items.map(item => (
                            <li key={item.id}>
                                {item.title}
                                {' '}
                                <button onClick={()=>{
                                    setSelectedItem(item);
                                }}>Select</button>
                            </li>
                        ))}
                    </ul>
                    <p>You selected {selectedItem.title}.</p>
                </div>
            )
        }

        function EditableMenuList(){
            const [items, setItems] = useState(initialItems);
            const [selectedItem, setSelectedItem] = useState(items[0]);

            function handleItemChange(id, e){
                setItems(items.map(item => {
                    if(item.id === id){
                        return{
                            ...item,
                            title: e.target.value,
                        };
                    } else {
                        return item
                    }
                }));
            }

            return(
                <>
                    <h2>What's your travel snack?</h2>
                    <ul>
                        {items.map((item, index) => (
                            <li key={item.id}>
                                <input 
                                    value={item.title}
                                    onChange={e => {
                                    handleItemChange(item.id, e)
                                }}
                                />
                                {' '}
                                <button onClick={() => {
                                    setSelectedItem(item);
                                }}>Choose</button>
                            </li>
                        ))}
                    </ul>
                    <p>You picked {selectedItem.title}.</p>
                </>
            );
        }

        function App(){
            return(
                <div>
                    <Intro/>
                </div>
            )
        }
        ReactDOM.render(<App/>, main)
    </script>
</body>
</html>